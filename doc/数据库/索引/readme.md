# 为什么

假设我们有一个名为 t_employee 的数据库表，这个数据库表有三列：name，age，address，数据量有上万行。

如果我们想要查找所有名为「leixiaoshuai」员工的详细信息，只需要写一个简单的 SQL 语句就可以搞定，相信大家都会写。

```sql
SELECT * FROM t_employee 
WHERE name = 'leixiaoshuai'
```

## 如果没有索引，会发生什么？

一旦我们运行了这条 SQL 查询语句，在数据库内部是如何工作的呢？数据库会搜索 t_employee 表中的每一行，从而确定员工的名字（name）是否为 ‘leixiaoshuai’。
由于我们想要得到每一个名字为 leixiaoshuai 的雇员信息，在查询到第一个符合条件的行记录后，不能停止查询，因为可能还有其他符合条件的行。
所以，必须一行一行的查找直到最后一行，这就意味数据库不得不检查上万行数据才能找到所有名字为 leixiaoshuai 的员工。这就是所谓的全表扫描。

这就是索引派上用场的时候了，使用索引的目的就是 **通过减少表中需要检查的记录/行的数量来加速搜索查询。** 说的再简单点：「索引就是用来加速查询的」。

# 是什么

索引本质是一种数据结构（最常见的是 B+树），是在表的列上创建的。

索引的数据结构是什么样的？

常见MySQL索引一般分为：Hash索引和 **B+** 树索引，InnoDB引擎中默认的是B+树。

B+树 是最常用于索引的数据结构，时间复杂度低：查找、删除、插入操作都可以可以在 log n 时间内完成。另外一个重要原因存储在 B+树 中的数据是有序的。

在B+树常规检索场景下，从根节点到叶子节点的搜索效率基本相当，不会出现大幅波动，而且基于索引的顺序扫描时，也可以利用双向指针快速左右移动，效率非常高。

哈希索引就是采用一定的哈希算法，把键值换算成新的哈希值，检索时不需要类似B+树那样从根节点到叶子节点逐级查找，只需一次哈希算法即可立刻定位到相应的位置，速度非常快。

## 哈希表索引是如何工作的？

如果你在创建索引时指定数据结构为「哈希表」，那这些索引也可称为「哈希索引」。

哈希索引的优点非常明显，在一定场景下，检索指定值时哈希表的效率极高。

比如上面我们讨论的一个查询语句：SELECT * FROM t_employee WHERE name = ‘leixiaoshuai’，如果在 name 列上加一个哈希索引，检索速度有可能会成倍提升。

## 哈系索引的工作方式: 

是将列的值作为索引的键值（key），键值相对应实际的值（value）是指向该表中相应行的指针。
因为哈希表基本上可以看作是关联数组，一个典型的数据项就像 「leixiaoshuai => 0x996996」，而 0x996996 是对内存中表中包含 leixiaoshuai 这一行的引用。
在哈系索引的中查询一个像 leixiaoshuai 这样的值，并得到对应行的在内存中的引用，明显要比扫描全表获得值为 leixiaoshuai 的行的方式快很多。

## 哈希索引的缺点：

哈希表是无顺的数据结构，对于很多类型的查询语句哈希索引都无能为力。举例来说，假如你想要找出所有小于40岁的员工。
你怎么使用使用哈希索引进行查询？这不可行，因为哈希表只适合查询键值对，也就是说查询相等的查询（例：like “WHERE name = ‘leixiaoshuai’）。
哈希表的键值映射也暗示其键的存储是无序的。这就是为什么哈希索引通常不是数据库索引的默认数据结构，因为在作为索引的数据结构时，其不像B+Tree那么灵活。

## 总结一下缺点：

（1）不支持范围查询
（2）不支持索引完成排序
（3）不支持联合索引的最左前缀匹配规则

还有什么其他类型的索引？
常见的还有：R 树和位图索引。

R 树通常用来为空间问题提供帮助。例如，一个查询要求“查询出所有距离我两公里之内的麦当劳”，如果数据库表使用R树索引，这类查询的效率将会提高。

位图索引（bitmap index）， 这类索引适合放在包含布尔值(true 和 false)的列上。

## 索引如何提高性能？

因为索引基本上是用来存储列值的数据结构，这使查找这些列值更加快速。如果索引使用B+树数据结构，那么其中的数据是有序的，有序的列值可以极大的提升性能。

假如我们在 name 这一列上创建一个 B+树 索引，这意味着当我们用之前的SQL查找name=‘leixiaoshuai‘时不需要再扫描全表，而是用索引查找去查找名字为‘leixiaoshuai’的员工，因为索引已经按照按字母顺序排序。
索引已经排序意味着查询一个名字会快很多，因为名字少字母为‘L’的员工都是排列在一起的。另外重要的一点是，索引同时存储了表中相应行的指针以获取其他列的数据。

数据库索引中到底存的是什么？

你现在已经知道数据库索引是创建在表的某列上的，并且存储了这一列的所有值。但是需要理解的重点是数据库索引并不存储这个表中其他列（字段）的值。
举例来说，如果我们在 name 列创建索引，那么 age 列和 address 列上的值并不会存储在这个索引当中。
如果我们确实把其他所有字段也存储在个这个索引中，那这样会占用太大的空间而且会十分低效。